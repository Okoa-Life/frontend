{"ast":null,"code":"import _regeneratorRuntime from\"/home/priscah/workshops/react/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"/home/priscah/workshops/react/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/home/priscah/workshops/react/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/priscah/workshops/react/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useContext,useEffect,useState}from\"react\";import{setDoc,uploadFile}from\"@junobuild/core\";import{AuthContext}from\"./Auth\";import{nanoid}from\"nanoid\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var Modal=function Modal(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showModal=_useState2[0],setShowModal=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),inputText=_useState4[0],setInputText=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),valid=_useState6[0],setValid=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),progress=_useState8[0],setProgress=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),file=_useState10[0],setFile=_useState10[1];var _useContext=useContext(AuthContext),user=_useContext.user;useEffect(function(){setValid(inputText!==\"\"&&user!==undefined&&user!==null);},[showModal,inputText,user]);var reload=function reload(){var event=new Event(\"reload\");window.dispatchEvent(event);};var add=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var url,filename,_yield$uploadFile,downloadUrl,key;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(![null,undefined].includes(user)){_context.next=2;break;}return _context.abrupt(\"return\");case 2:setProgress(true);_context.prev=3;if(!(file!==undefined)){_context.next=11;break;}filename=\"\".concat(user.key,\"-\").concat(file.name);// TODO: STEP_7_UPLOAD_FILE\n_context.next=8;return uploadFile({collection:\"images\",data:file,filename:filename});case 8:_yield$uploadFile=_context.sent;downloadUrl=_yield$uploadFile.downloadUrl;url=downloadUrl;case 11:key=nanoid();// TODO: STEP_5_SET_DOC\n_context.next=14;return setDoc({collection:\"notes\",doc:{key:key,data:_objectSpread({text:inputText},url!==undefined&&{url:url})}});case 14:setShowModal(false);reload();_context.next=21;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](3);console.error(_context.t0);case 21:setProgress(false);case 22:case\"end\":return _context.stop();}},_callee,null,[[3,18]]);}));return function add(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"mt-10 flex items-center justify-center gap-x-6\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:function onClick(){return setShowModal(true);},className:\"rounded-md bg-indigo-600 px-3.5 py-1.5 text-base font-semibold leading-7 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600\",children:\"Add an entry\"})}),showModal?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"justify-center items-center flex overflow-x-hidden overflow-y-auto fixed inset-0 z-50 outline-none focus:outline-none\",children:/*#__PURE__*/_jsx(\"div\",{className:\"relative w-auto my-6 mx-auto max-w-3xl\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"border-0 rounded-lg shadow-lg relative flex flex-col w-full bg-white outline-none focus:outline-none\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative p-6 flex-auto\",children:[/*#__PURE__*/_jsx(\"textarea\",{className:\" form-control block w-full px-3 py-1.5 text-base font-normal text-gray-700 bg-white bg-clip-padding border border-solid border-gray-300 rounded transition ease-in-out m-0 focus:text-gray-700 focus:bg-white focus:border-indigo-600 focus:outline-none resize-none \",rows:\"5\",placeholder:\"Your diary entry\",onChange:function onChange(e){setInputText(e.target.value);},value:inputText,disabled:progress}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",className:\"my-4 text-slate-500 text-lg leading-relaxed\",onChange:function onChange(event){var _event$target$files;return setFile((_event$target$files=event.target.files)===null||_event$target$files===void 0?void 0:_event$target$files[0]);},disabled:progress})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-end p-6 border-t border-solid border-slate-200 rounded-b\",children:progress?/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin inline-block w-6 h-6 border-[3px] border-current border-t-transparent text-indigo-600 rounded-full\",role:\"status\",\"aria-label\":\"loading\",children:/*#__PURE__*/_jsx(\"span\",{className:\"sr-only\",children:\"Loading...\"})}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"background-transparent font-bold uppercase px-6 py-2 text-sm outline-none focus:outline-none ease-linear transition-all duration-150\",type:\"button\",onClick:function onClick(){return setShowModal(false);},children:\"Close\"}),/*#__PURE__*/_jsx(\"button\",{className:\"rounded-md bg-indigo-600 px-3.5 py-1.5 text-base font-semibold leading-7 text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 disabled:opacity-25\",type:\"button\",onClick:add,disabled:!valid,children:\"Submit\"})]})})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"opacity-25 fixed inset-0 z-40 bg-black\"})]}):null]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}